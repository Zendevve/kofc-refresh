# Council ID Fix - Migration Guide

## Problem Fixed
Previously, the Council model used a custom `id` field as the primary key, which caused issues when renaming councils. When a council was renamed with a new number, the system tried to change the primary key, which resulted in:
- Council duplication
- Loss of member associations
- Data integrity issues

## Solution Implemented
Changed the Council model to:
1. Remove the custom `id` field as primary key
2. Use Django's default auto-incrementing `id` (primary key)
3. Add a new `council_number` field to store the extracted number from the council name

## Database Migration Steps

### Step 1: Create the Migration
Run the following command in your Django project:
```bash
python manage.py makemigrations
```

This will create a migration file that:
- Removes the custom `id` field
- Adds the `council_number` field
- Preserves all existing data and member associations

### Step 2: Apply the Migration
```bash
python manage.py migrate
```

### Step 3: Verify the Changes
After migration, verify that:
- All councils are still present
- All members still have their council associations
- The new `council_number` field is populated with extracted numbers from council names

## What Changed

### Models (models.py)
**Before:**
```python
class Council(models.Model):
    id = models.IntegerField(primary_key=True)
    name = models.CharField(max_length=100)
    district = models.CharField(max_length=100)
    # ... location fields
```

**After:**
```python
class Council(models.Model):
    # id is now auto-generated by Django (default behavior)
    name = models.CharField(max_length=100)
    council_number = models.CharField(max_length=50, null=True, blank=True)
    district = models.CharField(max_length=100)
    # ... location fields
```

### Views (council.py)
- Simplified `add_council` view - no longer tries to manage custom IDs
- Simplified `edit_council` view - now just updates fields without ID migration logic
- Both views extract the council number from the name and store it in `council_number` field

### Templates (manage_councils.html)
- Changed table header from "Council ID" to "ID"
- Changed display from `data.council.id` to `data.council.pk` (primary key)
- Updated all function calls to use `data.council.pk` instead of `data.council.id`

## Benefits
✅ Councils can be renamed freely without losing data
✅ Member associations are preserved during council renames
✅ No more duplication issues
✅ Cleaner, simpler code
✅ Better database integrity

## Rollback (if needed)
If you need to rollback this migration:
```bash
python manage.py migrate capstone_project <previous_migration_name>
```

Then delete the new migration file and run:
```bash
python manage.py makemigrations
python manage.py migrate
```
