{% extends 'base.html' %}
{% load static %}

{% block title %}
Knights of Columbus - Analytics
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/analytics.css' %}">

<div class="container">
    <h1>Analytics Overview</h1>
    <div class="filter-section">
        <form method="get" action="{% url 'analytics_view' %}">
            <label for="council_id">Filter by Council:</label>
            <select name="council_id" id="council_id" onchange="this.form.submit()">
                <option value="">All Councils</option>
                {% for council in councils %}
                    <option value="{{ council.id }}" {% if selected_council == council.id|stringformat:"s" %}selected{% endif %}>
                        {{ council.name }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <div class="summary-section">
        <h2>Summary Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Events</h3>
                <p>{{ summary_stats.total_events }}</p>
            </div>
            <div class="stat-card">
                <h3>Total Donations (PHP)</h3>
                <p>{{ summary_stats.total_donations }}</p>
            </div>
            <div class="stat-card">
                <h3>Total Members</h3>
                <p>{{ summary_stats.total_members }}</p>
            </div>
            <div class="stat-card">
                <h3>Total Officers</h3>
                <p>{{ summary_stats.total_officers }}</p>
            </div>
            <div class="stat-card">
                <h3>Average Donation (PHP)</h3>
                <p>{{ summary_stats.avg_donation|floatformat:2 }}</p>
            </div>
        </div>
    </div>

    <div class="chart-container" style="grid-area: events;">
        <h2>Events by Council</h2>
        <canvas id="eventsChart"></canvas>
    </div>

    <div class="chart-container" style="grid-area: donations;">
        <h2>Donations Per Month</h2>
        <canvas id="donationsChart"></canvas>
    </div>

    <div class="chart-container" style="grid-area: event-types;">
        <h2>Event Types Distribution</h2>
        <canvas id="eventTypesChart"></canvas>
    </div>

    <div class="chart-container" style="grid-area: members;">
        <h2>Members and Officers by Council</h2>
        <canvas id="membersOfficersChart"></canvas>
    </div>

    <div class="chart-container" style="grid-area: donation-sources;">
        <h2>Donation Sources</h2>
        <canvas id="donationSourcesChart"></canvas>
    </div>

    <div class="chart-container" style="grid-area: member-activity;">
        <h2>Member Activity</h2>
        <canvas id="memberActivityChart"></canvas>
    </div>

    <script id="eventsData" type="application/json">{{ events_data | safe }}</script>
    <script id="donationsData" type="application/json">{{ donations_data | safe }}</script>
    <script id="membersOfficersData" type="application/json">{{ members_officers_data | safe }}</script>
    <script id="eventTypesData" type="application/json">{{ event_types_data | safe }}</script>
    <script id="donationSourcesData" type="application/json">{{ donation_sources_data | safe }}</script>
    <script id="memberActivityData" type="application/json">{{ member_activity_data | safe }}</script>
    <input type="hidden" id="selectedCouncil" value="{{ selected_council|default:'' }}">
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="{% static 'js/analytics.js' %}"></script>
{% endblock %}