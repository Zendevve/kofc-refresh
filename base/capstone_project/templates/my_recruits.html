{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}My Recruits - Knights of Columbus{% endblock %}
{% block page_title %}My Recruits{% endblock %}
{% block page_subtitle %}Track your recruitment progress and degree advancement{% endblock %}

{% block header_actions %}
{% if request.user.role == 'admin' %}
<a href="{% url 'add_recruitment' %}" class="btn btn--primary">
  <i class="fas fa-plus"></i>
  <span>Add Record</span>
</a>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-4);
    margin-bottom: var(--space-6);
  }

  .stat-card {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-5);
    border: 1px solid var(--neutral-200);
    text-align: center;
    transition: all var(--transition-base);
  }

  .stat-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .stat-value {
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    color: var(--primary-600);
    line-height: 1;
    margin-bottom: var(--space-2);
  }

  .stat-label {
    font-size: var(--text-sm);
    color: var(--neutral-500);
  }

  .degree-section {
    background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    margin-bottom: var(--space-6);
    border: 1px solid var(--primary-200);
  }

  .degree-header {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }

  .degree-icon {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-full);
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
  }

  .degree-icon i {
    font-size: var(--text-2xl);
    color: var(--primary-600);
  }

  .degree-info h3 {
    margin: 0;
    font-size: var(--text-xl);
    color: var(--primary-900);
  }

  .degree-badge {
    display: inline-flex;
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: var(--font-bold);
  }

  .degree-badge.degree-1st { background: #22c55e; color: white; }
  .degree-badge.degree-2nd { background: #0ea5e9; color: white; }
  .degree-badge.degree-3rd { background: #8b5cf6; color: white; }
  .degree-badge.degree-4th { background: #ef4444; color: white; }

  .next-degree-box {
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin-top: var(--space-4);
  }

  .next-degree-box h4 {
    margin: 0 0 var(--space-3);
    font-size: var(--text-base);
    color: var(--neutral-700);
  }

  .requirements-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .requirements-list li {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) 0;
    font-size: var(--text-sm);
  }

  .requirements-list li i.fa-check-circle {
    color: var(--success-500);
  }

  .requirements-list li i.fa-times-circle {
    color: var(--error-500);
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
  }

  .section-header h2 {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--neutral-900);
  }

  .section-header i {
    color: var(--primary-500);
  }

  .recruits-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .recruit-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    background: white;
    padding: var(--space-4);
    border-radius: var(--radius-xl);
    border: 1px solid var(--neutral-200);
    transition: all var(--transition-base);
  }

  .recruit-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateX(4px);
    border-left: 3px solid var(--primary-500);
  }

  .recruit-avatar {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex-shrink: 0;
  }

  .recruit-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .recruit-avatar i {
    font-size: var(--text-xl);
    color: var(--primary-600);
  }

  .recruit-info {
    flex: 1;
    min-width: 0;
  }

  .recruit-name {
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: var(--neutral-900);
    margin-bottom: var(--space-1);
  }

  .recruit-badges {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
    margin-bottom: var(--space-2);
  }

  .role-badge {
    display: inline-flex;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
  }

  .role-badge.member { background: var(--success-100); color: var(--success-700); }
  .role-badge.officer { background: var(--info-100); color: var(--info-700); }
  .role-badge.admin { background: var(--warning-100); color: var(--warning-700); }

  .recruit-meta {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
    font-size: var(--text-sm);
    color: var(--neutral-500);
  }

  .recruit-meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .recruit-meta-item i {
    color: var(--neutral-400);
    font-size: var(--text-xs);
  }

  .empty-state {
    text-align: center;
    padding: var(--space-12);
    background: white;
    border-radius: var(--radius-xl);
    border: 1px solid var(--neutral-200);
  }

  .empty-state i {
    font-size: var(--text-4xl);
    color: var(--neutral-300);
    margin-bottom: var(--space-4);
  }

  .empty-state h3 {
    margin: 0 0 var(--space-2);
    font-size: var(--text-lg);
    color: var(--neutral-700);
  }

  .empty-state p {
    color: var(--neutral-500);
    margin: 0;
  }

  @media (max-width: 768px) {
    .recruit-card {
      flex-direction: column;
      text-align: center;
    }

    .recruit-badges {
      justify-content: center;
    }

    .recruit-meta {
      justify-content: center;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-value">{{ total_recruits }}</div>
    <div class="stat-label">Total Recruits</div>
  </div>
  <div class="stat-card">
    <div class="stat-value">{{ recent_recruits }}</div>
    <div class="stat-label">Last 30 Days</div>
  </div>
</div>

<!-- Degree Progress Section -->
<div class="degree-section">
  <div class="degree-header">
    <div class="degree-icon">
      <i class="fas fa-award"></i>
    </div>
    <div class="degree-info">
      <h3>Current Degree</h3>
      <span class="degree-badge degree-{{ request.user.current_degree|default:'1st' }}">{{ current_degree }}</span>
    </div>
  </div>

  {% if next_degree %}
  <div class="next-degree-box">
    <h4><i class="fas fa-arrow-up"></i> Next: {{ next_degree }}</h4>
    <ul class="requirements-list">
      {% if recruits_needed > 0 %}
      <li>
        <i class="fas fa-times-circle"></i>
        <span>Need {{ recruits_needed }} more recruit{{ recruits_needed|pluralize }}</span>
      </li>
      {% else %}
      <li>
        <i class="fas fa-check-circle"></i>
        <span>Recruitment requirement met</span>
      </li>
      {% endif %}

      {% if needs_event_attendance %}
      <li>
        {% if has_recent_attendance %}
        <i class="fas fa-check-circle"></i>
        <span>Event attendance requirement met</span>
        {% else %}
        <i class="fas fa-times-circle"></i>
        <span>Attend at least one event this month</span>
        {% endif %}
      </li>
      {% endif %}
    </ul>
  </div>
  {% else %}
  <div class="next-degree-box">
    <h4><i class="fas fa-star"></i> Congratulations!</h4>
    <p style="margin: 0; color: var(--neutral-600);">You've reached the highest degree (4th Degree).</p>
  </div>
  {% endif %}
</div>

<!-- Recruitment History -->
<div class="dashboard-card">
  <div class="dashboard-card-body">
    <div class="section-header">
      <i class="fas fa-users"></i>
      <h2>Recruitment History</h2>
    </div>

    {% if recruitments %}
    <div class="recruits-list">
      {% for recruitment in recruitments %}
      <div class="recruit-card">
        <div class="recruit-avatar">
          {% if recruitment.recruited.profile_picture %}
          <img src="{{ recruitment.recruited.profile_picture.url }}" alt="{{ recruitment.recruited.first_name }}">
          {% else %}
          <i class="fas fa-user"></i>
          {% endif %}
        </div>
        <div class="recruit-info">
          <div class="recruit-name">{{ recruitment.recruited.first_name }} {{ recruitment.recruited.last_name }}</div>
          <div class="recruit-badges">
            <span class="role-badge {{ recruitment.recruited.role }}">{{ recruitment.recruited.get_role_display }}</span>
            {% if recruitment.recruited.current_degree %}
            <span class="degree-badge degree-{{ recruitment.recruited.current_degree }}">{{ recruitment.recruited.get_current_degree_display }}</span>
            {% endif %}
          </div>
          <div class="recruit-meta">
            <span class="recruit-meta-item">
              <i class="fas fa-envelope"></i> {{ recruitment.recruited.email }}
            </span>
            <span class="recruit-meta-item">
              <i class="fas fa-shield-alt"></i> {{ recruitment.recruited.council.name|default:"No council" }}
            </span>
            <span class="recruit-meta-item">
              <i class="fas fa-calendar"></i> Joined {{ recruitment.recruited.date_joined|date:"M j, Y" }}
            </span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <i class="fas fa-user-plus"></i>
      <h3>No Recruits Yet</h3>
      <p>Invite others to join Knights of Columbus to earn higher degrees!</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
