<!-- Activity Log Sidebar Component -->
<div class="activity-log-container">
  <div class="activity-log-header">
    <h3><i class="fas fa-history"></i> Activity Log</h3>
    <span class="activity-filter-toggle" onclick="toggleActivityFilter()">
      <i class="fas fa-filter"></i>
    </span>
  </div>

  <!-- Filter Options -->
  <div class="activity-filter-panel" id="activityFilterPanel" style="display: none;">
    <div class="filter-group">
      <label class="filter-label">
        <input type="checkbox" class="activity-filter-checkbox" value="event" checked onchange="filterActivities()">
        <span>Events</span>
      </label>
      <label class="filter-label">
        <input type="checkbox" class="activity-filter-checkbox" value="attendance" checked onchange="filterActivities()">
        <span>Attendance</span>
      </label>
      <label class="filter-label">
        <input type="checkbox" class="activity-filter-checkbox" value="role" checked onchange="filterActivities()">
        <span>Role Changes</span>
      </label>
      <label class="filter-label">
        <input type="checkbox" class="activity-filter-checkbox" value="donation" checked onchange="filterActivities()">
        <span>Donations</span>
      </label>
      <label class="filter-label">
        <input type="checkbox" class="activity-filter-checkbox" value="recruitment" checked onchange="filterActivities()">
        <span>Recruitment</span>
      </label>
    </div>
  </div>

  <!-- Membership Info Card -->
  <div class="membership-info-card">
    <div class="info-item">
      <span class="info-label">Member Since</span>
      <span class="info-value">{{ user.date_joined|date:"M d, Y" }}</span>
      {% if membership_duration %}<span class="info-duration">{{ membership_duration }} days</span>{% endif %}
    </div>
    <div class="info-item">
      <span class="info-label">Current Council</span>
      <span class="info-value">{{ user.council.name|default:"Not Assigned" }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Current Role</span>
      <span class="info-value role-badge">
        {% if user.role == 'admin' %}District Director
        {% elif user.role == 'officer' %}Council Officer
        {% else %}Member{% endif %}
        {% if council_duration %}<br><span style="font-size: 0.85rem; font-weight: normal;">for {{ council_duration }} days</span>{% endif %}
      </span>
    </div>
    {% if past_council_positions %}
    <div class="info-item">
      <span class="info-label">Past Council Position</span>
      {% for position in past_council_positions %}
      <div style="margin-top: 0.5rem; padding: 0.5rem; background: transparent; border-radius: 4px; font-size: 0.9rem;">
        <span class="info-value">{{ position.role|title }} of {{ position.council.name }}</span>
        <span class="info-duration">{{ position.duration_days }} days</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <!-- Role History -->
  {% if role_history %}
  <div class="role-history-card">
    <h4 class="card-title"><i class="fas fa-crown"></i> Role History</h4>
    <div class="role-timeline">
      {% for role in role_history %}
      <div class="role-entry">
        <div class="role-entry-header">
          <span class="role-name">{{ role.get_role_display|default:role.role }}</span>
          <span class="role-date">{{ role.date_assigned|date:"M d, Y" }}</span>
        </div>
        {% if role.duration %}
        <span class="role-duration">Duration: {{ role.duration }} days</span>
        {% endif %}
        {% if role.council %}
        <span class="role-council">{{ role.council.name }}</span>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Activities Timeline -->
  <div class="activities-timeline">
    <h4 class="card-title"><i class="fas fa-list"></i> Recent Activities</h4>
    <div class="timeline-container" id="timelineContainer">
      {% for activity in activities %}
      <div class="timeline-item activity-item" data-activity-type="{{ activity.type }}">
        <div class="timeline-marker">
          {% if activity.type == 'event' %}
            <i class="fas fa-calendar-check"></i>
          {% elif activity.type == 'attendance' %}
            <i class="fas fa-check-circle"></i>
          {% elif activity.type == 'role' %}
            <i class="fas fa-crown"></i>
          {% elif activity.type == 'donation' %}
            <i class="fas fa-hand-holding-heart"></i>
          {% elif activity.type == 'recruitment' %}
            <i class="fas fa-user-plus"></i>
          {% elif activity.type == 'council_movement' %}
            <i class="fas fa-exchange-alt"></i>
          {% else %}
            <i class="fas fa-circle"></i>
          {% endif %}
        </div>
        <div class="timeline-content">
          <p class="activity-title">{{ activity.title }}</p>
          <p class="activity-description">{{ activity.description }}</p>
          <span class="activity-date" title="{{ activity.date|date:'M d, Y' }}">
            {{ activity.date|timesince }} ago
          </span>
        </div>
      </div>
      {% empty %}
      <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>No activities yet</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<style>
  .activity-log-container {
    background: white;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    padding: 1.5rem;
    max-height: 800px;
    overflow-y: auto;
  }

  .activity-log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f3f4f6;
  }

  .activity-log-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .activity-log-header i {
    color: #2563eb;
  }

  .activity-filter-toggle {
    cursor: pointer;
    color: #6b7280;
    font-size: 1rem;
    transition: color 0.2s;
  }

  .activity-filter-toggle:hover {
    color: #2563eb;
  }

  .activity-filter-panel {
    background: #f9fafb;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border: 1px solid #e5e7eb;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .filter-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.85rem;
    color: #374151;
  }

  .filter-label input {
    cursor: pointer;
  }

  .membership-info-card {
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    border-radius: 10px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
    color: white;
  }

  .info-item {
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
  }

  .info-item:last-child {
    margin-bottom: 0;
  }

  .info-label {
    font-size: 0.75rem;
    opacity: 0.85;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
  }

  .info-value {
    font-size: 1rem;
    font-weight: 600;
  }

  .info-duration {
    font-size: 0.8rem;
    opacity: 0.75;
    margin-top: 0.25rem;
  }

  .role-badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
  }

  .role-history-card {
    background: #f9fafb;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    border: 1px solid #e5e7eb;
  }

  .card-title {
    margin: 0 0 1rem 0;
    font-size: 0.95rem;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .card-title i {
    color: #2563eb;
  }

  .role-timeline {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .role-entry {
    background: white;
    padding: 0.75rem;
    border-radius: 6px;
    border-left: 3px solid #2563eb;
  }

  .role-entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.25rem;
  }

  .role-name {
    font-weight: 600;
    color: #111827;
    font-size: 0.9rem;
  }

  .role-date {
    font-size: 0.75rem;
    color: #6b7280;
  }

  .role-duration,
  .role-council {
    display: block;
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 0.25rem;
  }

  .activities-timeline {
    margin-top: 1.5rem;
  }

  .timeline-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-height: 400px;
    overflow-y: auto;
  }

  .timeline-item {
    display: flex;
    gap: 1rem;
    padding: 0.75rem;
    border-radius: 8px;
    transition: background 0.2s;
  }

  .timeline-item:hover {
    background: #f9fafb;
  }

  .timeline-marker {
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #dbeafe;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #2563eb;
    font-size: 0.9rem;
  }

  .timeline-content {
    flex: 1;
    min-width: 0;
  }

  .activity-title {
    margin: 0;
    font-weight: 600;
    color: #111827;
    font-size: 0.9rem;
  }

  .activity-description {
    margin: 0.25rem 0 0 0;
    color: #6b7280;
    font-size: 0.8rem;
  }

  .activity-date {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.75rem;
    color: #9ca3af;
  }

  .empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: #9ca3af;
  }

  .empty-state i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    display: block;
  }

  .empty-state p {
    margin: 0;
    font-size: 0.9rem;
  }

  /* Scrollbar styling */
  .timeline-container::-webkit-scrollbar {
    width: 6px;
  }

  .timeline-container::-webkit-scrollbar-track {
    background: #f3f4f6;
    border-radius: 3px;
  }

  .timeline-container::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
  }

  .timeline-container::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }
</style>

<script>
  function toggleActivityFilter() {
    const panel = document.getElementById('activityFilterPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
  }

  function filterActivities() {
    const checkboxes = document.querySelectorAll('.activity-filter-checkbox:checked');
    const selectedTypes = Array.from(checkboxes).map(cb => cb.value);
    const items = document.querySelectorAll('.activity-item');

    items.forEach(item => {
      const type = item.getAttribute('data-activity-type');
      item.style.display = selectedTypes.includes(type) ? 'flex' : 'none';
    });
  }
</script>
